<nav class="navbar navbar-expand-lg bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand text-white" href="#">PDF-Chat</a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"></ul>
      @if (!isAuthenticated) {
      <button
        class="btn btn-success btn-margin"
        type="button"
        data-bs-toggle="modal"
        data-bs-target="#loginModal"
      >
        Login
      </button>
      <button
        class="btn btn-outline-primary"
        type="button"
        data-bs-toggle="modal"
        data-bs-target="#registerModal"
      >
        Register
      </button>
      } @else { @if (user?.isAdmin) {
      <button
        class="btn btn-success btn-margin"
        type="button"
        data-bs-toggle="modal"
        data-bs-target="#addPdfModal"
      >
        <i class="bi bi-file-earmark-arrow-up"></i>
        Upload PDF
      </button>
      }
      <button class="btn btn-danger" type="button" (click)="logout()">
        Logout
      </button>
      }
    </div>
  </div>
</nav>

<div id="loginModal" class="modal" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Login</h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="input-group mb-3">
          <span class="input-group-text" id="username-addon">{{ "@" }}</span>
          <input
            type="text"
            class="form-control"
            placeholder="Username"
            aria-label="Username"
            aria-describedby="username-addon"
            [(ngModel)]="loginData.name"
          />
        </div>
        <div class="input-group mb-3">
          <input
            type="password"
            class="form-control"
            placeholder="Password"
            aria-label="Password"
            [(ngModel)]="loginData.password"
          />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary"
          data-bs-dismiss="modal"
          (click)="login()"
        >
          Login
        </button>
      </div>
    </div>
  </div>
</div>

<div id="registerModal" class="modal" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Register</h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="input-group mb-3">
          <span class="input-group-text" id="username-addon">{{ "@" }}</span>
          <input
            type="text"
            class="form-control"
            placeholder="Username"
            aria-label="Username"
            aria-describedby="username-addon"
            [(ngModel)]="registerData.name"
          />
        </div>
        <div class="input-group mb-3">
          <input
            type="password"
            class="form-control"
            placeholder="Password"
            aria-label="Password"
            [(ngModel)]="registerData.password"
          />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary"
          data-bs-dismiss="modal"
          (click)="register()"
        >
          Register
        </button>
      </div>
    </div>
  </div>
</div>

<div id="createChatModal" class="modal" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Create new chat</h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="input-group mb-3">
          <input
            type="text"
            class="form-control"
            placeholder="Chat title"
            aria-label="Chat title"
            [(ngModel)]="newChatTitle"
          />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary"
          data-bs-dismiss="modal"
          (click)="addChat()"
        >
          Create
        </button>
      </div>
    </div>
  </div>
</div>

<div id="addPdfModal" class="modal" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Upload new PDF</h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="input-group mb-3">
          <input
            class="form-control"
            type="file"
            id="formFile"
            (change)="onFileSelected($event)"
          />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary"
          data-bs-dismiss="modal"
          (click)="onUpload()"
        >
          Upload
        </button>
      </div>
    </div>
  </div>
</div>

@if (showSuccess) {
<div class="alert alert-success" role="alert">
  {{ successMessage }}
</div>
} @if (showError) {
<div class="alert alert-danger" role="alert">
  {{ errorMessage }}
</div>
} @if (showInfo) {
<div class="alert alert-info" role="alert">
  {{ infoMessage }}
</div>
} @if (isAuthenticated) {
<div class="container-fluid chat-container">
  <div class="row flex-nowrap">
    <div class="col-auto col-md-3 col-xl-2 px-sm-2 px-0 bg-dark">
      <div
        class="d-flex flex-column align-items-center align-items-sm-start px-3 pt-2 text-white chat-container"
      >
        <ul
          class="nav nav-pills flex-column mb-sm-auto mb-0 align-items-center align-items-sm-start"
          id="menu"
        >
          <button
            class="btn btn-primary chat-add-button"
            data-bs-toggle="modal"
            data-bs-target="#createChatModal"
          >
            <i class="bi bi-plus"></i>
            Add Chat
          </button>
          @for (chat of user?.chats; track $index) {
          <li class="nav-item">
            <a
              href="#"
              class="nav-link align-middle"
              (click)="setActiveChat(chat.id!)"
            >
              <i class="fas fa-comments"></i>
              <span class="ms-1 d-none d-sm-inline">{{ chat.title }}</span>
            </a>
          </li>
          }
        </ul>
      </div>
    </div>
    <div class="col py-3 chat-window">
      @for (chat of user?.chats; track $index) { @if (activeChat === chat.id) {
      <app-chat
        [messages]="chat.messages!"
        [isTyping]="chat.messages?.at(-1)?.answer !== undefined ? false : true"
        class="chat"
      ></app-chat>
      } } @if (activeChat !== "") {
      <div class="chat-input">
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            placeholder="Question"
            aria-label="Users question"
            aria-describedby="question-addon"
            [(ngModel)]="question"
            [disabled]="waitingForAnswer"
          />
          <div class="input-group-append chat-window">
            <button
              class="btn btn-outline-secondary"
              type="button"
              (click)="addMessage()"
              [disabled]="waitingForAnswer"
            >
              Send
              <i class="bi bi-send"></i>
            </button>
          </div>
        </div>
      </div>
      }@else {
      <div class="not-selected-chat">
        <h1 class="display-1">Welcome to PDF-Chat</h1>
        <p class="lead">Please select a chat to start chatting</p>
      </div>
      }
    </div>
  </div>
</div>
}@else{
<div class="not-authenticated-container">
  <h1 class="display-1">Welcome to PDF-Chat</h1>
  <p class="lead">Please login or register to use the chat</p>
</div>
}
